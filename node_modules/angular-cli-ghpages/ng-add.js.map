{"version":3,"file":"ng-add.js","sourceRoot":"","sources":["../ng-add.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,+CAAkD;AAClD,2DAIoC;AACpC,mCAAqC;AAM9B,MAAM,KAAK,GAAG,CAAC,OAAqB,EAAE,EAAE,CAAC,CAC9C,IAAU,EACV,OAAyB,EACzB,EAAE;;IACF,MAAM,IAAI,GAAG,IAAA,kBAAU,EAAC,IAAI,CAAC,CAAC;IAC9B,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,iBAAU,CAAC,aAAa,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAEhE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE;QACpB,IAAI,SAAS,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,EAAE;YAEjC,OAAO,CAAC,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;SAC5D;aAAM;YACL,MAAM,IAAI,gCAAmB,CAC3B,8GAA8G,CAC/G,CAAC;SACH;KACF;IAED,MAAM,OAAO,GAAG,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;IACxD,IAAI,CAAC,OAAO,EAAE;QACZ,MAAM,IAAI,gCAAmB,CAC3B,gEAAgE,CACjE,CAAC;KACH;IAED,IAAI,OAAO,CAAC,UAAU,CAAC,WAAW,KAAK,aAAa,EAAE;QACpD,MAAM,IAAI,gCAAmB,CAC3B,0EAA0E,CAC3E,CAAC;KACH;IAGD,MAAM,WAAW,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IACjD,IAAI,CAAC,WAAW,EAAE;QAChB,MAAM,IAAI,gCAAmB,CAC3B,qDAAqD,OAAO,CAAC,OAAO,oBAAoB,CACzF,CAAC;KACH;IAOD,MAAM,UAAU,GAAG,MAAA,WAAW,CAAC,OAAO,0CAAE,UAAU,CAAC;IACnD,MAAM,kBAAkB,GACtB,UAAU,KAAK,SAAS;QACxB,OAAO,UAAU,KAAK,QAAQ;QAC9B,CAAC,OAAO,UAAU,KAAK,QAAQ,IAAI,UAAU,KAAK,IAAI,IAAI,MAAM,IAAI,UAAU,CAAC,CAAC;IAElF,IAAI,CAAC,kBAAkB,EAAE;QACvB,MAAM,IAAI,gCAAmB,CAC3B,6DAA6D,OAAO,CAAC,OAAO,qBAAqB;YACjG,8EAA8E,CAC/E,CAAC;KACH;IAED,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC;QAClB,IAAI,EAAE,QAAQ;QACd,OAAO,EAAE,4BAA4B;QACrC,OAAO,EAAE,EAAE;KACZ,CAAC,CAAC;IAEH,iBAAU,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IAG3C,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACxB,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,kCAAkC,CAAC,CAAC;IACxD,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACxB,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACnC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,2EAA2E,CAAC,CAAC;IACjG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,4BAA4B,CAAC,CAAC;IAClD,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;IAE7C,OAAO,IAAI,CAAC;AACd,CAAC,CAAA,CAAC;AA3EW,QAAA,KAAK,SA2EhB","sourcesContent":["import { workspaces } from '@angular-devkit/core';\nimport {\n  SchematicContext,\n  SchematicsException,\n  Tree\n} from '@angular-devkit/schematics';\nimport { createHost } from './utils';\n\ninterface NgAddOptions {\n  project: string;\n}\n\nexport const ngAdd = (options: NgAddOptions) => async (\n  tree: Tree,\n  context: SchematicContext\n) => {\n  const host = createHost(tree);\n  const { workspace } = await workspaces.readWorkspace('/', host);\n\n  if (!options.project) {\n    if (workspace.projects.size === 1) {\n      // If there is only one project, return that one.\n      options.project = Array.from(workspace.projects.keys())[0];\n    } else {\n      throw new SchematicsException(\n        'There is more than one project in your workspace. Please select it manually by using the --project argument.'\n      );\n    }\n  }\n\n  const project = workspace.projects.get(options.project);\n  if (!project) {\n    throw new SchematicsException(\n      'The specified Angular project is not defined in this workspace'\n    );\n  }\n\n  if (project.extensions.projectType !== 'application') {\n    throw new SchematicsException(\n      `Deploy requires an Angular project type of \"application\" in angular.json`\n    );\n  }\n\n  // Validate build target exists (required for deployment)\n  const buildTarget = project.targets.get('build');\n  if (!buildTarget) {\n    throw new SchematicsException(\n      `Cannot find build target for the Angular project \"${options.project}\" in angular.json.`\n    );\n  }\n\n  // outputPath validation:\n  // - Angular 20+: outputPath is omitted (uses default dist/<project-name>)\n  // - Angular 17-19: object format { base: \"dist/app\", browser: \"\", ... }\n  // - Earlier versions: string format \"dist/app\"\n  // See: https://github.com/angular/angular-cli/pull/26675\n  const outputPath = buildTarget.options?.outputPath;\n  const hasValidOutputPath =\n    outputPath === undefined || // Angular 20+ uses sensible defaults\n    typeof outputPath === 'string' ||\n    (typeof outputPath === 'object' && outputPath !== null && 'base' in outputPath);\n\n  if (!hasValidOutputPath) {\n    throw new SchematicsException(\n      `Invalid outputPath configuration for the Angular project \"${options.project}\" in angular.json. ` +\n      `Expected undefined (default), a string, or an object with a \"base\" property.`\n    );\n  }\n\n  project.targets.add({\n    name: 'deploy',\n    builder: 'angular-cli-ghpages:deploy',\n    options: {}\n  });\n\n  workspaces.writeWorkspace(workspace, host);\n\n  // Show next steps\n  context.logger.info('');\n  context.logger.info('ðŸš€ angular-cli-ghpages is ready!');\n  context.logger.info('');\n  context.logger.info('Next steps:');\n  context.logger.info('  1. Read the docs: https://github.com/angular-schule/angular-cli-ghpages');\n  context.logger.info('  2. Deploy via: ng deploy');\n  context.logger.info('  3. Have a nice day!');\n\n  return tree;\n};\n"]}