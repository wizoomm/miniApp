{"version":3,"file":"actions.js","sourceRoot":"","sources":["../../deploy/actions.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,yDAAmF;AAEnF,gDAAwB;AAExB,8CAAmF;AAGnF,SAA8B,MAAM,CAClC,MAMC,EACD,OAAuB,EACvB,WAAwB,EACxB,OAAe;;;QAGf,IAAI,OAAO,CAAC,OAAO,EAAE;YACnB,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;SAC1C;aAAM;YACL,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;gBACnB,MAAM,IAAI,KAAK,CAAC,iCAAiC,CAAC,CAAC;aACpD;YAED,MAAM,SAAS,qBACV,CAAC,OAAO,CAAC,QAAQ,IAAI,EAAE,QAAQ,EAAE,OAAO,CAAC,QAAQ,EAAE,CAAC,CACxD,CAAC;YAEF,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,OAAO,CAAC,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC;YAC/D,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,oBAAoB,WAAW,CAAC,IAAI,GAAG,CAAC,CAAC;YAE7D,MAAM,KAAK,GAAG,MAAM,OAAO,CAAC,cAAc,CACxC,IAAA,kCAAsB,EAAC,WAAW,CAAC,IAAI,CAAC,kCAEnC,WAAW,CAAC,OAAO,GACnB,SAAS,EAEf,CAAC;YACF,MAAM,WAAW,GAAG,MAAM,KAAK,CAAC,MAAM,CAAC;YAEvC,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE;gBACxB,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;aAClD;SACF;QAID,IAAI,GAAW,CAAC;QAChB,IAAI,OAAO,CAAC,GAAG,EAAE;YAEf,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC;SAEnB;aAAM;YAEL,MAAM,YAAY,GAAG,MAAM,OAAO,CAAC,gBAAgB,CACjD,IAAA,kCAAsB,EAAC,WAAW,CAAC,IAAI,CAAC,CACzC,CAAC;YAUF,MAAM,UAAU,GAAG,YAAY,CAAC,UAA2C,CAAC;YAE5E,IAAI,UAAU,KAAK,SAAS,EAAE;gBAG5B,MAAM,WAAW,GAAG,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBACnD,GAAG,GAAG,cAAI,CAAC,IAAI,CAAC,MAAM,EAAE,WAAW,EAAE,SAAS,CAAC,CAAC;aACjD;iBAAM,IAAI,OAAO,UAAU,KAAK,QAAQ,EAAE;gBACzC,GAAG,GAAG,cAAI,CAAC,IAAI,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;aACxC;iBAAM,IAAI,IAAA,+BAAkB,EAAC,UAAU,CAAC,EAAE;gBAGzC,GAAG,GAAG,cAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,MAAA,UAAU,CAAC,OAAO,mCAAI,SAAS,CAAC,CAAC;aACnE;iBAAM;gBACL,MAAM,IAAI,KAAK,CACb,6DAA6D,WAAW,CAAC,IAAI,KAAK;oBAClF,4CAA4C,CAC7C,CAAC;aACH;SACF;QAED,MAAM,MAAM,CAAC,GAAG,CACd,GAAG,EACH,OAAO,EACP,OAAO,CAAC,MAAM,CACf,CAAC;;CACH;AAxFD,yBAwFC","sourcesContent":["import { BuilderContext, targetFromTargetString } from '@angular-devkit/architect';\nimport { logging } from '@angular-devkit/core';\nimport path from 'path';\n\nimport { BuildTarget, AngularOutputPath, isOutputPathObject } from '../interfaces';\nimport { Schema } from './schema';\n\nexport default async function deploy(\n  engine: {\n    run: (\n      dir: string,\n      options: Schema,\n      logger: logging.LoggerApi\n    ) => Promise<void>;\n  },\n  context: BuilderContext,\n  buildTarget: BuildTarget,\n  options: Schema\n) {\n  // 1. BUILD\n  if (options.noBuild) {\n    context.logger.info(`ðŸ“¦ Skipping build`);\n  } else {\n    if (!context.target) {\n      throw new Error('Cannot execute the build target');\n    }\n\n    const overrides = {\n      ...(options.baseHref && { baseHref: options.baseHref })\n    };\n\n    context.logger.info(`ðŸ“¦ Building \"${context.target.project}\"`);\n    context.logger.info(`ðŸ“¦ Build target \"${buildTarget.name}\"`);\n\n    const build = await context.scheduleTarget(\n      targetFromTargetString(buildTarget.name),\n      {\n        ...buildTarget.options,\n        ...overrides\n      }\n    );\n    const buildResult = await build.result;\n\n    if (!buildResult.success) {\n      throw new Error('Error while building the app.');\n    }\n  }\n\n  // 2. DEPLOYMENT\n\n  let dir: string;\n  if (options.dir) {\n\n    dir = options.dir;\n\n  } else {\n\n    const buildOptions = await context.getTargetOptions(\n      targetFromTargetString(buildTarget.name)\n    );\n\n    // Output path configuration\n    // The outputPath option can be either:\n    // - undefined (Angular 20+): uses default dist/<project-name>/browser\n    // - a String which will be used as the base value + default value 'browser'\n    // - or an Object for more fine-tune configuration.\n    // see https://angular.io/guide/workspace-config#output-path-configuration\n    // see https://github.com/angular/angular-cli/pull/26675\n\n    const outputPath = buildOptions.outputPath as AngularOutputPath | undefined;\n\n    if (outputPath === undefined) {\n      // Angular 20+ default: dist/<project-name>/browser\n      // Extract project name from buildTarget.name (format: \"project:target:configuration\")\n      const projectName = buildTarget.name.split(':')[0];\n      dir = path.join('dist', projectName, 'browser');\n    } else if (typeof outputPath === 'string') {\n      dir = path.join(outputPath, 'browser');\n    } else if (isOutputPathObject(outputPath)) {\n      // browser defaults to 'browser' per Angular CLI schema\n      // Explicit empty string '' means no subfolder (browser files directly in base)\n      dir = path.join(outputPath.base, outputPath.browser ?? 'browser');\n    } else {\n      throw new Error(\n        `Unsupported outputPath configuration in angular.json for '${buildTarget.name}'. ` +\n        `Expected string or {base, browser} object.`\n      );\n    }\n  }\n\n  await engine.run(\n    dir,\n    options,\n    context.logger\n  );\n}\n"]}