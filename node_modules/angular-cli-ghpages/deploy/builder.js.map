{"version":3,"file":"builder.js","sourceRoot":"","sources":["../../deploy/builder.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,yDAImC;AAEnC,yDAA2C;AAC3C,wDAA+B;AAQ/B,SAAsB,aAAa,CACjC,OAAe,EACf,OAAuB;;QAGvB,IAAK,OAAmC,CAAC,aAAa,EAAE;YACtD,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,gDAAgD,CAAC,CAAC;YACvE,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,+BAA+B,CAAC,CAAC;YACtD,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;SAC3B;QAED,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;YACnB,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;SACnE;QAED,MAAM,iBAAiB,GAAgB;YACrC,IAAI,EACF,OAAO,CAAC,WAAW,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,OAAO,mBAAmB;SACtE,CAAC;QAEF,IAAI,oBAA6C,CAAC;QAClD,IAAI,OAAO,CAAC,eAAe,EAAE;YAC3B,oBAAoB,GAAG;gBACrB,IAAI,EAAE,OAAO,CAAC,eAAe;aAC9B,CAAC;SACH;QAUD,MAAM,gBAAgB,GAAG,oBAAoB;YAC3C,CAAC,CAAC,oBAAoB;YACtB,CAAC,CAAC,iBAAiB,CAAC;QAEtB,IAAI;YACF,MAAM,IAAA,iBAAM,EAAC,MAAM,EAAE,OAAO,EAAE,gBAAgB,EAAE,OAAO,CAAC,CAAC;SAC1D;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,4CAA4C,CAAC,CAAC;YACnE,MAAM,OAAO,GAAG,CAAC,YAAY,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAC3D,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YAC9B,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;SAC3B;QAED,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;IAC3B,CAAC;CAAA;AAjDD,sCAiDC;AAOD,kBAAe,IAAA,yBAAa,EAAC,aAAa,CAAC,CAAC","sourcesContent":["import {\n  BuilderContext,\n  BuilderOutput,\n  createBuilder\n} from '@angular-devkit/architect';\n\nimport * as engine from '../engine/engine';\nimport deploy from './actions';\nimport { Schema } from './schema';\nimport { BuildTarget } from '../interfaces';\n\n/**\n * The core builder handler function.\n * Exported separately for testing purposes.\n */\nexport async function executeDeploy(\n  options: Schema,\n  context: BuilderContext\n): Promise<BuilderOutput> {\n  // browserTarget is not supported - use buildTarget instead\n  if ((options as Record<string, unknown>).browserTarget) {\n    context.logger.error('❌ The \"browserTarget\" option is not supported.');\n    context.logger.error('   Use \"buildTarget\" instead.');\n    return { success: false };\n  }\n\n  if (!context.target) {\n    throw new Error('Cannot deploy the application without a target');\n  }\n\n  const staticBuildTarget: BuildTarget = {\n    name:\n      options.buildTarget || `${context.target.project}:build:production`\n  };\n\n  let prerenderBuildTarget: BuildTarget | undefined;\n  if (options.prerenderTarget) {\n    prerenderBuildTarget = {\n      name: options.prerenderTarget\n    };\n  }\n\n  // serverBuildTarget is not supported and is completely ignored\n  // let serverBuildTarget: BuildTarget | undefined;\n  // if (options.ssr) {\n  //   serverBuildTarget = {\n  //     name: options.serverTarget || options.universalBuildTarget || `${context.target.project}:server:production`\n  //   };\n  // }\n\n  const finalBuildTarget = prerenderBuildTarget\n    ? prerenderBuildTarget\n    : staticBuildTarget;\n\n  try {\n    await deploy(engine, context, finalBuildTarget, options);\n  } catch (e) {\n    context.logger.error('❌ An error occurred when trying to deploy:');\n    const message = e instanceof Error ? e.message : String(e);\n    context.logger.error(message);\n    return { success: false };\n  }\n\n  return { success: true };\n}\n\n// Call the createBuilder() function to create a builder. This mirrors\n// createJobHandler() but add typings specific to Architect Builders.\n//\n// if something breaks here, see how angularfire has fixed it:\n// https://github.com/angular/angularfire/blob/master/src/schematics/deploy/builder.ts\nexport default createBuilder(executeDeploy);\n"]}